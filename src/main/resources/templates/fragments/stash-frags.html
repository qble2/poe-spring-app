<!DOCTYPE html>
<html
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="https://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
</head>
<body>
	<!-- FRAGMENT :: reload-stash-tabs-list -->
	<button
		th:fragment="reload-stash-tabs-list"
		id="reload-stash-tabs-list"
		class="reload-stash-tabs-list outline"
		hx-trigger="click"
		hx-ext="loading-states"
		hx-include="#select-league-dropdown-menu-select"
		data-loading-aria-busy
		data-loading-target="#reload-stash-tabs-list"
		th:attr="hx-post=|/stash-tabs/reload-stash-tabs-list|"
		hx-target="#stash-tabs-list"
		hx-swap="outerHTML">Reload stash tabs</button>

	<!-- FRAGMENT :: stash-tabs-list -->
	<div
		th:fragment="stash-tabs-list"
		id="stash-tabs-list"
		class="stash-tabs-list">
		<div
			th:each="stashTab: ${stashTabs}"
			th:class="stash-tab-header"
			th:classappend="|clickable stash-tab-header-${stashTab.type}|"
			th:style="|background-color: ${stashTab.getHexColor()}|"
			hx-trigger="click"
			th:attr="hx-get=|/stash-tabs/${stashTab.id}|"
			hx-target="#stash-tab-items"
			hx-swap="outerHTML">
			<span
				class="stash-tab-header-name"
				th:text="${stashTab.name}"></span>
		</div>
	</div>

	<!-- FRAGMENT :: stash-tab-items -->
	<div
		th:fragment="stash-tab-items"
		id="stash-tab-items"
		class="stash-tab-items">

		<th:block th:if="${stashTab != null}">

			<div
				th:style="|min-height: 62px; color: white; background-color: ${stashTab.getHexColor()}; display: grid; align-items: center; justify-content: center;|"
				th:text="${stashTab.name}"></div>

			<div class="flex-column">
				<div style="display: flex; flex-direction: row; gap: 10px;">
					<button
						class="outline"
						hx-ext="loading-states"
						data-loading-aria-busy
						hx-trigger="click"
						th:attr="hx-post=|/stash-tabs/${stashTab.id}|"
						hx-target="#stash-tab-items"
						hx-swap="outerHTML">Reload items</button>

					<button
						class="outline"
						th:if="${not #lists.isEmpty(stashTab.items)}"
						hx-ext="loading-states"
						data-loading-aria-busy
						hx-trigger="click"
						th:attr="hx-post=|/stash-tabs/${stashTab.id}/price-check|"
						hx-target="#stash-tab-items"
						hx-swap="outerHTML">Price check items</button>
				</div>

				<div style="display: flex; flex-direction: row; gap: 10px;">
					<div>Last reload:</div>
					<div
						th:if="${stashTab.reloadedAt != null}"
						th:text="${#temporals.format(stashTab.reloadedAt, 'dd/MM/yyyy HH:mm:ss')}"></div>
					<div th:unless="${stashTab.reloadedAt != null}">N/A</div>
				</div>

				<div style="display: flex; flex-direction: row; gap: 10px;">
					<div>Last price check:</div>
					<div
						th:if="${stashTab.priceCheckedAt != null}"
						th:text="${#temporals.format(stashTab.priceCheckedAt, 'dd/MM/yyyy HH:mm:ss')}"></div>
					<div th:unless="${stashTab.priceCheckedAt != null}">N/A</div>
				</div>

			</div>

			<!-- Bootstrap Table
				data-toggle="table" does not seem to work on AJAX loaded content.
					$('#stash-tab-items-table').bootstrapTable() is used instead.
				Bootstrap CSS conflicts with Pico.css and has been disabled
					data-show-multi-sort requires Bootstrap CSS to work properly.
					data-pagination requires Bootstrap CSS to work properly.
			-->
			<table
				id="stash-tab-items-table"
				data-toggle="table"
				data-search="true"
				data-show-columns="false"
				data-pagination="false"
				data-show-multi-sort="true"
				data-sort-name="chaosValue"
				data-sort-order="desc"
				data-sort-empty-last="true"
				role="grid"
				th:if="${not #lists.isEmpty(stashTab.items)}">
				<thead>
					<tr>
						<th
							scope="col"
							data-field="icon"
							data-sortable="false"
							class="align-center">icon</th>
						<th
							scope="col"
							data-field="name"
							data-sortable="false">name</th>
						<th
							scope="col"
							data-field="baseType"
							data-sortable="false">baseType</th>
						<th
							scope="col"
							data-field="frameType"
							data-sortable="true">f</th>
						<!-- 						<th scope="col" data-field="category" data-sortable="false">category</th> -->
						<!-- 						<th scope="col" data-field="detailsId" data-sortable="false">detailsId</th> -->
						<th
							scope="col"
							data-field="stackSize"
							data-sortable="false">quant</th>
						<th
							scope="col"
							data-field="chaosValue"
							data-sortable="true">price</th>
						<!-- sort does not seem to work on the total field since its a calculated field -->
						<th
							scope="col"
							data-field="total"
							data-sortable="false">total</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="item: ${stashTab.items}">
						<td class="align-center">
							<img
								class="stash-item-icon"
								alt="icon"
								th:src="${item.icon}"
								th:title="${item.name} + ' ' + ${item.baseType}">
						</td>
						<td th:text="${item.name}"></td>
						<td th:text="${item.baseType}"></td>
						<td th:text="${item.frameType}"></td>
						<!-- 						<td th:text="${item.category?.value}"></td> -->
						<!-- 						<td th:text="${item.poeNinjaDetailsId}"></td> -->
						<td th:text="${item.stackSize}"></td>
						<td th:text="${item.chaosValue}"></td>
						<td>
							<span
								th:if="${item.chaosValue != null && item.stackSize != null}"
								th:text="${#numbers.formatDecimal(item.chaosValue * item.stackSize,0,2)}"></span>
							<span
								th:if="${item.chaosValue != null && item.stackSize == null}"
								th:text="${item.chaosValue}"></span>
						</td>
					</tr>
				</tbody>
			</table>
		</th:block>
	</div>

</body>
</html>